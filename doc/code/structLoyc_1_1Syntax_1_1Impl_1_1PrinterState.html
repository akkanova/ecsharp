<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Enhanced C#: Loyc.Syntax.Impl.PrinterState Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Enhanced C#
   </div>
   <div id="projectbrief">Language of your choice: library documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceLoyc.html">Loyc</a></li><li class="navelem"><a class="el" href="namespaceLoyc_1_1Syntax.html">Syntax</a></li><li class="navelem"><a class="el" href="namespaceLoyc_1_1Syntax_1_1Impl.html">Impl</a></li><li class="navelem"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState.html">PrinterState</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Nested classes</a> &#124;
<a href="#pub-attribs">Public fields</a> &#124;
<a href="#properties">Properties</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Loyc.Syntax.Impl.PrinterState Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A helper type for printer objects. Its primary purposes are to manage indentation and to "revoke" newlines; it also tracks the current line/column number. 
 <a href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState.html#details">More...</a></p>
<hr/><b>Source file</b>:<ul>
<li><a href='https://github.com/qwertie/ecsharp/tree/master/Core/Loyc.Syntax/PrinterState.cs'>/Core/Loyc.Syntax/PrinterState.cs</a></li>
</ul>
<a name="details" id="details"></a><h2 class="groupheader">Remarks</h2>
<div class="textblock"><p>A helper type for printer objects. Its primary purposes are to manage indentation and to "revoke" newlines; it also tracks the current line/column number.</p>
<p>Be careful not to duplicate this structure. </p>
<p>When pretty-printing any language as text, it's a challenge to decide where to place newlines. You may want to break up long lines into shorter ones, as in </p><pre>
if (ReallyLongIdentifier[Fully.Qualified.Name(multiple, parameters)] 
   &gt; SomeConstant)
{
   return ReallyLongIdentifier[firstThing + secondThing] 
      + thirdThing + fourthThing;
}
</pre><p> Conversely, you may want to print something on one line that you would ordinarily print on two: </p><pre>
    if (c) break;
</pre><p> Of course, the problem is, you don't know how long the syntax tree will be in text form until after you try to print it. </p>
<p>My first idea to solve this problem was to use a <a href="https://en.wikipedia.org/wiki/Rope_(data_structure)">rope</a> tree data structure - inner syntax trees would produce small strings that could be "roped" together to produce a bigger tree. But ropes tend not to use memory efficiently, and there was the challenge, which I didn't see how to solve, of how to keep the tree balanced efficiently (for this particular application perhaps a balanced tree wasn't needed, but as a perfectionist I didn't want to implement a "half-baked" data structure.) </p>
<p>Next I thought of the solution used here, a simpler solution based on an ordinary StringBuilder. My idea was to insert newlines "pessimistically"</p><ul>
<li>insert them everywhere in which they might be needed - and then selectively "revoke" them later if they turn out to be unnecessary. Only the most recently-written newline(s) can be revoked, which keeps the implementation simple and also limits the performance cost of deleting the newlines. </li>
</ul>
<p>To use, call <a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState.html#a4f63680db5b4cfeb88698e5b840addf1" title="Writes a newline and the appropriate amount of indentation afterward.">Newline()</a> to write a newline (with indentation). To make a decision about whether to keep or revoke the most recent newline(s), call RevokeOrCommitNewlines(cp, maxLineLength) where cp is a "checkpoint" representing some point before the first newline want to potentially revoke, and maxLineLength is the line length threshold: if the line length after combining lines, starting at the line on which the checkpoint is located, does not exceed maxLineLength, then the newlines are revoked, otherwise ALL newlines are committed (so earlier newlines can no longer be revoked.) </p>
<p>This design allows a potentially long series of newlines to be deleted in the reverse order that they were created, but if any newline is kept then previous ones can no longer be deleted. </p>
<p>For an example of how this is used, see the JSON printer in LLLPG samples or look at the implementation of the LESv3 printer. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Nested classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public fields</h2></td></tr>
<tr class="memitem:a8594f6f92be4558f095aad551cd85189"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8594f6f92be4558f095aad551cd85189"></a>
StringBuilder&#160;</td><td class="memItemRight" valign="bottom"><b>S</b></td></tr>
<tr class="separator:a8594f6f92be4558f095aad551cd85189"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf060687213177b250a9b84cfec7d92b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acf060687213177b250a9b84cfec7d92b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>IndentLevel</b></td></tr>
<tr class="separator:acf060687213177b250a9b84cfec7d92b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c09a938b8e5b1f6ec0ac18ecbfae541"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8c09a938b8e5b1f6ec0ac18ecbfae541"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>LineNo</b></td></tr>
<tr class="separator:a8c09a938b8e5b1f6ec0ac18ecbfae541"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a743532454017f518f6cd968d5d6fa559"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a743532454017f518f6cd968d5d6fa559"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>IndentString</b></td></tr>
<tr class="separator:a743532454017f518f6cd968d5d6fa559"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f8e3753d8248c01f8d5eae773d107d4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4f8e3753d8248c01f8d5eae773d107d4"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>NewlineString</b></td></tr>
<tr class="separator:a4f8e3753d8248c01f8d5eae773d107d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="properties"></a>
Properties</h2></td></tr>
<tr class="memitem:ac38f7aaba3c9c0553e5087e2c6256c68"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac38f7aaba3c9c0553e5087e2c6256c68"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>LineStartIndex</b><code> [get]</code></td></tr>
<tr class="separator:ac38f7aaba3c9c0553e5087e2c6256c68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9967d2510b2d4fd89f3417c78e93345e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9967d2510b2d4fd89f3417c78e93345e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>IndexInCurrentLine</b><code> [get]</code></td></tr>
<tr class="separator:a9967d2510b2d4fd89f3417c78e93345e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af396cfa94770d912dfe5bb1e0b3544b8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af396cfa94770d912dfe5bb1e0b3544b8"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>IndexInCurrentLineAfterIndent</b><code> [get]</code></td></tr>
<tr class="separator:af396cfa94770d912dfe5bb1e0b3544b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad9f114944425a9f4e1794b830924652"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aad9f114944425a9f4e1794b830924652"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>AtStartOfLine</b><code> [get]</code></td></tr>
<tr class="separator:aad9f114944425a9f4e1794b830924652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33d17a29e93dfb5ce01ebaee90e1e002"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState.html#a33d17a29e93dfb5ce01ebaee90e1e002">Length</a><code> [get]</code></td></tr>
<tr class="memdesc:a33d17a29e93dfb5ce01ebaee90e1e002"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current length of the output string <a href="#a33d17a29e93dfb5ce01ebaee90e1e002">More...</a><br /></td></tr>
<tr class="separator:a33d17a29e93dfb5ce01ebaee90e1e002"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3cfaf2402526182c40ea3f6cb6739a4e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3cfaf2402526182c40ea3f6cb6739a4e"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>PrinterState</b> (StringBuilder s, string indent=&quot;\t&quot;, string newline=&quot;\n&quot;)</td></tr>
<tr class="separator:a3cfaf2402526182c40ea3f6cb6739a4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25d4e57cc9d4bd3d7d96855a17f52784"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a25d4e57cc9d4bd3d7d96855a17f52784"></a>
StringBuilder&#160;</td><td class="memItemRight" valign="bottom"><b>Append</b> (string s)</td></tr>
<tr class="separator:a25d4e57cc9d4bd3d7d96855a17f52784"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6bf0f571bfc88a631311e7772388e34"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad6bf0f571bfc88a631311e7772388e34"></a>
<a class="el" href="structLoyc_1_1void.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><b>Indent</b> ()</td></tr>
<tr class="separator:ad6bf0f571bfc88a631311e7772388e34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ee7829087d5e714c7b5087e42130a63"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1ee7829087d5e714c7b5087e42130a63"></a>
<a class="el" href="structLoyc_1_1void.html">void</a>&#160;</td><td class="memItemRight" valign="bottom"><b>Dedent</b> ()</td></tr>
<tr class="separator:a1ee7829087d5e714c7b5087e42130a63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae62e4c9cf4099e75fb2e53d48471849d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae62e4c9cf4099e75fb2e53d48471849d"></a>
<a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a>&#160;</td><td class="memItemRight" valign="bottom"><b>GetCheckpoint</b> ()</td></tr>
<tr class="separator:ae62e4c9cf4099e75fb2e53d48471849d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f63680db5b4cfeb88698e5b840addf1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState.html#a4f63680db5b4cfeb88698e5b840addf1">Newline</a> (int changeIndentLevel=0)</td></tr>
<tr class="memdesc:a4f63680db5b4cfeb88698e5b840addf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a newline and the appropriate amount of indentation afterward. <a href="#a4f63680db5b4cfeb88698e5b840addf1">More...</a><br /></td></tr>
<tr class="separator:a4f63680db5b4cfeb88698e5b840addf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b96f0b91765de18bdbb7f6a65f1378b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState.html#a7b96f0b91765de18bdbb7f6a65f1378b">RevokeOrCommitNewlines</a> (<a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a> cp, int maxLineWidth)</td></tr>
<tr class="memdesc:a7b96f0b91765de18bdbb7f6a65f1378b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Revokes or commits newlines added since the specified checkpoint. Recent newlines are revoked if the combined line length after revokation does not exceed <code>maxLineWidth</code>, otherwise ALL newlines are committed permanently. <a href="#a7b96f0b91765de18bdbb7f6a65f1378b">More...</a><br /></td></tr>
<tr class="separator:a7b96f0b91765de18bdbb7f6a65f1378b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d809d4f3de9630289a0a1c9effb488a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1d809d4f3de9630289a0a1c9effb488a"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>CommitNewlines</b> ()</td></tr>
<tr class="separator:a1d809d4f3de9630289a0a1c9effb488a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4909c3bc10e341d4c59261c8ac5c6c3f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4909c3bc10e341d4c59261c8ac5c6c3f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>RevokeNewlinesSince</b> (<a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a> cp)</td></tr>
<tr class="separator:a4909c3bc10e341d4c59261c8ac5c6c3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a4f63680db5b4cfeb88698e5b840addf1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a> Loyc.Syntax.Impl.PrinterState.Newline </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>changeIndentLevel</em> = <code>0</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes a newline and the appropriate amount of indentation afterward.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">changeIndentLevel</td><td>Amount by which to change IndentLevel before writing the newline</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A <a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a> that can be used to revoke the newline</dd></dl>
<p>Note that "revoking" a newline does NOT restore the original indent level.</p>

</div>
</div>
<a class="anchor" id="a7b96f0b91765de18bdbb7f6a65f1378b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Loyc.Syntax.Impl.PrinterState.RevokeOrCommitNewlines </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structLoyc_1_1Syntax_1_1Impl_1_1PrinterState_1_1Checkpoint.html">Checkpoint</a>&#160;</td>
          <td class="paramname"><em>cp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxLineWidth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Revokes or commits newlines added since the specified checkpoint. Recent newlines are revoked if the combined line length after revokation does not exceed <code>maxLineWidth</code>, otherwise ALL newlines are committed permanently.</p>
<dl class="section return"><dt>Returns</dt><dd>0 if the method had no effect, -N if N newlines were revoked, and +N if N newlines were committed.</dd></dl>
<p>This method does not affect the indent level.</p>

<p>References <a class="el" href="structLoyc_1_1Collections_1_1Impl_1_1InternalList.html#a4ad4f447018d5be2bc6cc8c6e1b33ef3">Loyc.Collections.Impl.InternalList&lt; T &gt;.Clear()</a>.</p>

</div>
</div>
<h2 class="groupheader">Property Documentation</h2>
<a class="anchor" id="a33d17a29e93dfb5ce01ebaee90e1e002"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Loyc.Syntax.Impl.PrinterState.Length</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Current length of the output string</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 17 2020 19:38:14 for Enhanced C# by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
